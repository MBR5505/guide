<%- include("./partials/head") %>
<body>
    <h1>Ny Guide</h1>
    <div class="kreft">
        <form class="nyGuide" id="nyGuideForm" method="post" enctype="multipart/form-data">
            <input type="hidden" name="newSectionCount" id="newSectionCount" value="1">
            <label for="tittel">Tittel</label>
            <br>
            <input type="text" name="tittel" id="tittel">
            <br>
            <label for="tag">Tag</label>
            <br>
            <select name="tag" id="tag">
                <option value="Linux">Linux</option>
                <option value="VM">VM</option>
                <option value="Annet">Annet</option>
            </select>
            <br>

            <div id="sectionsContainer">
                <div id="addNewSection1">
                    <h2>Selskpm</h2>
                    <label for="overskrift1">Overskrift</label>
                    <br>
                    <input type="text" name="overskrift1" id="overskrift1">
                    <br>
                    <label for="beskrivelse1">Beskrivelse</label>
                    <br>
                    <input type="text" name="beskrivelse1" style="width: 300px; height: 40px;" id="beskrivelse1">
                    <br>
                    <img id="previewImage$" src="" alt="Image Preview" style="max-width: 300px; max-height: 300px;">
                    <br>
                    <input type="file" name="velgFil1" id="velgFil1" accept="image/png, image/jpg, image/jpeg">
                    <br>
                </div>
            </div>

            <input type="submit" value="Submit Guide">
        </form>
        <button id="ja" onclick="ny()">Lag ny Seksjon</button>
        <br>
    </div>

    <script defer>
        let newSectionCount = 1; // Initialize the section count

        function ny() {
            newSectionCount++; // Increment the section count
            document.getElementById("newSectionCount").value = newSectionCount; // Update hidden field

            // Create a new section HTML
            const newSectionHTML = `
                <div id="addNewSection${newSectionCount}">
                    <h2>Selskpm</h2>
                    <label for="overskrift${newSectionCount}">Overskrift</label>
                    <br>
                    <input type="text" name="overskrift${newSectionCount}" id="overskrift${newSectionCount}">
                    <br>
                    <label for="beskrivelse${newSectionCount}">Beskrivelse</label>
                    <br>
                    <input type="text" name="beskrivelse${newSectionCount}" id="beskrivelse${newSectionCount}">
                    <br>
                    <img id="previewImage${newSectionCount}" src="" alt="Image Preview" style="max-width: 300px; max-height: 300px;">
                    <br>
                    <input type="file" name="velgFil${newSectionCount}" id="velgFil${newSectionCount}" accept="image/png, image/jpg, image/jpeg">
                    <br>
                </div>
            `;

            // Append the new section to the container
            document.getElementById("sectionsContainer").insertAdjacentHTML("beforeend", newSectionHTML);

            // Add event listener for the file input of the new section
            const newFileInput = document.getElementById(`velgFil${newSectionCount}`);
            newFileInput.addEventListener("change", function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgElement = document.getElementById(`previewImage${newSectionCount}`);
                        if (imgElement) {
                            imgElement.src = e.target.result; // Set the image preview if the element exists
                        } else {
                            console.error(`Image preview element not found for section index: ${newSectionCount}`);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    </script>
</body>
</html>
