<%- include("./partials/head") %>
<body>
    <h1>Ny Guide</h1>
    <div class="ny-guide-container">
        <h1 class="ny-guide-title">Ny Guide</h1>
        <div class="kreft">
            <form class="nyGuide" id="nyGuideForm" method="post" enctype="multipart/form-data">
                <input type="hidden" name="newSectionCount" id="newSectionCount" value="1">
                <label for="tittel">Tittel</label>
                <input type="text" name="tittel" id="tittel">
                
                <label for="tag">Tag</label>
                <select name="tag" id="tag">
                    <option value="Linux">Linux</option>
                    <option value="VM">VM</option>
                    <option value="Annet">Annet</option>
                </select>

                <div id="sectionsContainer">
                    <div id="addNewSection1">
                        <h2 class="section-title">Seksjon</h2>
                        <label for="overskrift1">Overskrift</label>
                        <input type="text" name="overskrift1" id="overskrift1">
                        
                        <label for="beskrivelse1">Beskrivelse</label>
                        <input type="text" name="beskrivelse1" id="beskrivelse1">
                        
                        <img id="previewImage1" class="preview-image" src="" alt="Image Preview">
                        
                        <div class="file-drop-area" id="fileDropArea1">
                            <span class="fake-btn">Choose files</span>
                            <span class="file-msg">or drag and drop files here</span>
                            <input type="file" name="velgFil1" id="velgFil1" accept="image/png, image/jpg, image/jpeg" class="file-input">
                        </div>
                    </div>
                </div>

                <input type="submit" value="Submit Guide">
            </form>
            <button id="ja" onclick="ny()">Lag ny Seksjon</button>
        </div>
    </div>

    <style>
        .file-drop-area {
            position: relative;
            display: flex;
            align-items: center;
            width: 300px;
            max-width: 100%;
            padding: 25px;
            border: 1px dashed #ccc;
            border-radius: 3px;
            transition: 0.2s;
        }

        .file-drop-area.is-active {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .fake-btn {
            flex-shrink: 0;
            background-color: rgba(255, 255, 255, 0.04);
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 8px 15px;
            margin-right: 10px;
            font-size: 12px;
            text-transform: uppercase;
        }

        .file-msg {
            font-size: small;
            font-weight: 300;
            line-height: 1.4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            cursor: pointer;
            opacity: 0;
        }
    </style>

    <script defer>
        let newSectionCount = 1;

        function ny() {
            newSectionCount++;
            document.getElementById("newSectionCount").value = newSectionCount;

            const newSectionHTML = `
                <div id="addNewSection${newSectionCount}">
                    <h2>Selskpm</h2>
                    <label for="overskrift${newSectionCount}">Overskrift</label>
                    <br>
                    <input type="text" name="overskrift${newSectionCount}" id="overskrift${newSectionCount}">
                    <br>
                    <label for="beskrivelse${newSectionCount}">Beskrivelse</label>
                    <br>
                    <input type="text" name="beskrivelse${newSectionCount}" id="beskrivelse${newSectionCount}">
                    <br>
                    <img id="previewImage${newSectionCount}" src="" alt="Image Preview" style="max-width: 300px; max-height: 300px;">
                    <br>
                    <div class="file-drop-area" id="fileDropArea${newSectionCount}">
                        <span class="fake-btn">Choose files</span>
                        <span class="file-msg">or drag and drop files here</span>
                        <input type="file" name="velgFil${newSectionCount}" id="velgFil${newSectionCount}" accept="image/png, image/jpg, image/jpeg" class="file-input">
                    </div>
                    <br>
                </div>
            `;

            document.getElementById("sectionsContainer").insertAdjacentHTML("beforeend", newSectionHTML);
            initializeFileUpload(newSectionCount);
        }

        function initializeFileUpload(sectionIndex) {
            const dropArea = document.getElementById(`fileDropArea${sectionIndex}`);
            const fileInput = document.getElementById(`velgFil${sectionIndex}`);
            const fileMsg = dropArea.querySelector('.file-msg');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropArea.classList.add('is-active');
            }

            function unhighlight() {
                dropArea.classList.remove('is-active');
            }

            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                fileInput.files = files;
                handleFiles(files);
            }

            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    fileMsg.textContent = file.name;
                    previewFile(file);
                }
            }

            function previewFile(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.getElementById(`previewImage${sectionIndex}`);
                    if (imgElement) {
                        imgElement.src = e.target.result;
                    } else {
                        console.error(`Image preview element not found for section index: ${sectionIndex}`);
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Initialize the first file upload area
        initializeFileUpload(1);
    </script>
</body>
</html>